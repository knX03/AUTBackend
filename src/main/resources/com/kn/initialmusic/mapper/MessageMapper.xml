<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kn.initialmusic.mapper.MessageMapper">
    <insert id="createMessage">
        insert into message(message_id, poster_id, message_content)
            value (#{message_id}, #{poster_id}, #{message_content})
    </insert>
    <insert id="insertUserMessage">
        insert into usermessage(user_id, message_id)
            value (#{user_ID}, #{message_id})
    </insert>
    <delete id="delMess">
        delete
        from usermessage
        where message_id = #{message_id}
          and user_id = #{user_ID}
    </delete>


    <select id="isRepeatedByID" resultType="java.lang.String">
        select message_id
        from message
        where message_id = #{id}
    </select>
    <select id="getMessages" resultType="com.kn.initialmusic.pojo.Message">
        select message.message_id,
               poster_id,
               user_name   as poster_name,
               user_avatar as poster_avatar,
               post_time,
               message_content
        from usermessage,
             message,
             user
        where usermessage.user_id = #{user_ID}
          and message.message_id = usermessage.message_id
          and poster_id = user.user_ID
    </select>
    <select id="getMessageUser" resultType="java.lang.String">
        select sUser_id as user_id, user_name, user_avatar
        from messageuser,
             user
        where fUser_id = #{user_ID}
          and user_ID = sUser_id
        UNION ALL
        select fUser_id as user_id, user_name, user_avatar
        from messageuser,
             user
        where sUser_id = #{user_ID}
          and user_ID = fUser_id;
    </select>
    <select id="getMessagesList" resultType="com.kn.initialmusic.webSocket.pojo.FormatMess">
        select user_ID         as poster_ID,
               user_name       as poster_Name,
               user_avatar     as poster_Avatar,
               message_content as messageText,
               post_time       as post_Time
        from message,
             user
        where fUser_id = #{fUser_ID}
          and sUser_id = #{sUser_ID}
          and poster_id = user_ID
    </select>
</mapper>